---
sidebar: sidebar 
permalink: br-use-vmware-restore-vmdks-from-backups.html 
keywords:  
summary: 您可以从传统虚拟机或 vVol 虚拟机的主备份或辅助备份中恢复现有的 VMDK 或已删除或分离的 VMDK。 
---
= 从备份中恢复特定虚拟磁盘
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
您可以从传统虚拟机的主备份或辅助备份中恢复现有的虚拟磁盘 (VMDK)，或者已删除或已分离的虚拟磁盘。这样，您就可以只恢复特定的虚拟机数据或应用程序，而无需在仅影响特定数据的情况下恢复整个虚拟机及其所有关联的虚拟磁盘。虚拟磁盘恢复后，会附加到其原始虚拟机，即可使用。

您可以将虚拟机上的一个或多个虚拟机磁盘 (VMDK) 还原到同一数据存储或不同的数据存储。


TIP: 为了提高 NFS 环境中恢复操作的性能，请启用 VMware 应用程序 vStorage API for Array Integration (VAAI)。

.开始之前
* 必须存在备份。
* VM 不得处于传输状态。
+
您要恢复的虚拟机不能处于 vMotion 或 Storage vMotion 状态。



.关于此任务
* 如果 VMDK 被删除或从 VM 中分离，则还原操作会将 VMDK 附加到 VM。
* 如果虚拟机所在的FabricPool的存储层不可用，则恢复操作可能会失败。
* 连接和恢复操作使用默认的 SCSi 控制器连接 VMDK。但是，当备份连接到具有 NVMe 磁盘的 VM 的 VMDK 时，连接和恢复操作将使用 NVMe 控制器（如果可用）。


.步骤
. 从NetApp Backup and Recovery菜单中，选择 *恢复*。
. 从名称搜索字段右侧的下拉列表中，选择 *VMware*。
. 输入要恢复的资源的名称，或者筛选要恢复的资源所在的 vCenter、数据中心或数据存储。
+
将显示符合您搜索条件的虚拟机列表。

. 在列表中找到要从中恢复的虚拟机，然后选择该虚拟机的选项菜单按钮。
. 在出现的菜单中，选择“恢复虚拟磁盘”。
+
显示在该虚拟机上创建的快照（还原点）列表。默认情况下，会显示您在“时间范围”下拉菜单中选择的时间范围内的最新快照。

+
对于每个快照，*位置*列中任何亮起的图标都表示快照可用的存储位置（主存储、辅助存储或对象存储）。

. 启用要恢复的快照对应的单选按钮。
. 选择“下一步”。
+
显示快照位置选项。

. 选择快照的还原目标位置：
+
** *本地*：从本地位置恢复快照。
** *辅助*：从远程存储位置恢复快照。
** *对象存储*：从对象存储恢复快照。
+
如果选择辅助存储，请从下拉列表中选择目标位置。



. 选择“下一步”。
. 选择目标设置以及恢复前和恢复后选项：


[discrete]
===== 目的地选择

[role="tabbed-block"]
====
.恢复到原始位置
--
恢复到原始位置时，您无法更改目标 vCenter、ESXi 主机、数据存储或虚拟磁盘的名称。原虚拟磁盘被覆盖。

. 选择“原始位置”窗格。
. 在“目标设置”部分，选中要恢复的任何虚拟磁盘的复选框。
. 从下列选项中进行选择：
+
** *恢复前选项*部分：
+
*** *预设脚本*：启用此选项可在恢复操作开始前运行自定义脚本，以自动执行其他任务。请输入要运行的脚本的完整路径以及脚本接受的所有参数。


** *恢复后选项*部分：
+
*** *附言*：启用此选项可在恢复完成后运行自定义脚本，从而自动执行其他任务。请输入要运行的脚本的完整路径以及脚本接受的所有参数。




. 选择*恢复*。


--
.恢复至备用位置
--
恢复到备用位置时，您可以更改目标数据存储。无论您选择哪个数据存储，恢复操作后虚拟磁盘都会附加到原始虚拟机。

. 选择“备用位置”窗格。
. 在“目标设置”部分，选中要恢复的任何虚拟磁盘的复选框。
. 对于您选择的任何虚拟磁盘：
+
.. 选择“选择数据存储”可为虚拟磁盘选择不同的数据存储还原目标。
.. 选择“选择”以确认您的选择并关闭选择窗口。


. 从下列选项中进行选择：
+
** *恢复前选项*部分：
+
*** *预设脚本*：启用此选项可在恢复操作开始前运行自定义脚本，以自动执行其他任务。请输入要运行的脚本的完整路径以及脚本接受的所有参数。


** *恢复后选项*部分：
+
*** *附言*：启用此选项可在恢复完成后运行自定义脚本，从而自动执行其他任务。请输入要运行的脚本的完整路径以及脚本接受的所有参数。




. 选择*恢复*。


--
====