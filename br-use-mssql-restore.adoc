---
sidebar: sidebar 
permalink: br-use-mssql-restore.html 
keywords: backing up, restoring, back up, backup, restore, cloud volumes ontap, aws, azure, s3, blob, google cloud, storagegrid, back up volumes, cloud backup, restore volumes, cost, on-premises ontap, onprem, applications, virtual machines, backup and recovery 
summary: 从快照副本、复制到辅助存储的工作负载备份或存储在对象存储中的备份恢复数据库工作负载。 
---
= 使用NetApp Backup and Recovery恢复 Microsoft SQL Server 工作负载
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
使用NetApp Backup and Recovery恢复 Microsoft SQL Server 工作负载。使用快照副本、复制到辅助存储的备份或对象存储中的备份。将工作负载恢复到原始系统、具有相同云帐户的不同系统或本地ONTAP系统。

.从这些位置恢复
您可以从不同的起始位置恢复工作负载：

* 从主要位置还原
* 从复制的资源还原
* 从对象存储备份恢复


.恢复到这些点
您可以将数据还原到最新快照或以下点：

* 从快照还原
* 如果您知道文件名、位置和最后有效日期，则还原到特定时间点
* 恢复到最新备份


.从对象存储中恢复的注意事项
如果您选择对象存储中的备份文件，并且该备份的勒索软件恢复功能处于活动状态（如果您在备份策略中启用了 DataLock 和勒索软件恢复功能），则系统会提示您在恢复数据之前对备份文件运行额外的完整性检查。我们建议您执行扫描。


TIP: 您需要向云提供商支付额外费用才能访问备份文件。



== 恢复工作负载的工作原理

恢复工作负载时，会发生以下情况：

* 当您从备份文件恢复工作负载时， NetApp Backup and Recovery会使用备份中的数据创建一个_新_资源。
* 从复制的工作负载恢复时，您可以将工作负载恢复到原始系统或本地ONTAP系统。
+
image:diagram_browse_restore_volume-unified.png["显示恢复资源的流程的图表"]

* 从对象存储还原备份时，您可以将数据还原到原始系统或本地ONTAP系统。




== 恢复方法

使用以下方法之一恢复工作负载：

* *从恢复页面*：当您不知道资源的名称、位置或最后有效日期时，使用此选项可恢复资源。使用过滤器搜索快照。
* *从库存页面*：当您知道特定资源的名称、位置和最后有效日期时，使用此选项可恢复该资源。浏览列表以查找资源。


*所需的NetApp Console角色* 存储查看器、备份和恢复超级管理员或备份和恢复备份管理员角色。 https://docs.netapp.com/us-en/console-setup-admin/reference-iam-predefined-roles.html["了解所有服务的NetApp Console访问角色"^] 。



== 从“恢复”选项恢复工作负载数据

使用恢复选项恢复数据库工作负载。

.步骤
. 从NetApp Backup and Recovery菜单中，选择 *恢复*。
. 选择要还原的数据库。使用过滤器进行搜索。
. 选择恢复选项：
+
** 从快照还原
** 如果您知道文件名、位置和最后有效日期，则还原到特定时间点
** 恢复到最新备份






=== 从快照恢复工作负载

. 继续从恢复选项页面，选择*从快照恢复*。
+
出现快照列表。

. 选择要恢复的快照。
. 选择“下一步”。
+
接下来您将看到目的地选项。

. 在目的地详情页面中，输入以下信息：
+
** *目标设置*：选择是否将数据恢复到原始位置还是其他位置。对于备用位置，选择主机名和实例，输入数据库名称，然后输入要还原快照的目标路径。
** *预恢复选项*：
+
*** *恢复时覆盖同名数据库*：恢复时，保留原始数据库名称。
*** *保留 SQL 数据库复制设置*：恢复操作后保留 SQL 数据库的复制设置。
*** *恢复前创建事务日志备份*：在恢复操作之前创建事务日志备份。***  *如果还原前的事务日志备份失败，则退出还原*：如果事务日志备份失败，则停止还原操作。
*** *Prescript*：输入应在恢复操作之前运行的脚本的完整路径、脚本所需的任何参数以及等待脚本完成的时间。


** *恢复后选项*：
+
*** *可操作*，但无法恢复其他事务日志。应用事务日志备份后，数据库将恢复在线状态。
*** *不可操作*，但可用于恢复额外的事务日志。在还原事务日志备份的同时，在还原操作后将数据库维持在非操作状态。此选项对于恢复额外的事务日志很有用。
*** *只读模式*，可用于恢复额外的事务日志。以只读模式恢复数据库并应用事务日志备份。
*** *后记*：输入恢复操作后应运行的脚本的完整路径以及脚本所采用的任何参数。




. 选择*恢复*。




=== 恢复到特定时间点

NetApp Backup and Recovery使用日志和最新的快照来创建数据的时间点恢复。

. 继续从“恢复选项”页面，选择“*恢复到特定时间点*”。
. 选择“下一步”。
. 在“还原到特定时间点”页面中，输入以下信息：
+
** *数据恢复的日期和时间*：输入您要恢复的数据的确切日期和时间。此日期和时间来自 Microsoft SQL Server 数据库主机。


. 选择*搜索*。
. 选择要恢复的快照。
. 选择“下一步”。
. 在目的地详情页面中，输入以下信息：
+
** *目标设置*：选择是否将数据恢复到原始位置还是其他位置。对于备用位置，请选择主机名和实例，输入数据库名称，然后输入目标路径。
** *预恢复选项*：
+
*** *保留原始数据库名称*：在恢复过程中，保留原始数据库名称。
*** *保留 SQL 数据库复制设置*：恢复操作后保留 SQL 数据库的复制设置。
*** *Prescript*：输入应在恢复操作之前运行的脚本的完整路径、脚本所需的任何参数以及等待脚本完成的时间。


** *恢复后选项*：
+
*** *可操作*，但无法恢复其他事务日志。应用事务日志备份后，数据库将恢复在线状态。
*** *不可操作*，但可用于恢复额外的事务日志。在还原事务日志备份的同时，在还原操作后将数据库维持在非操作状态。此选项对于恢复额外的事务日志很有用。
*** *只读模式*，可用于恢复额外的事务日志。以只读模式恢复数据库并应用事务日志备份。
*** *后记*：输入恢复操作后应运行的脚本的完整路径以及脚本所采用的任何参数。




. 选择*恢复*。




=== 恢复到最新备份

此选项使用最新的完整备份和日志备份将数据恢复到最后的良好状态。系统扫描从上次快照到现在的日志。该过程跟踪变化和活动以恢复数据的最新和最准确的版本。

. 继续从恢复选项页面，选择*恢复到最新备份*。
+
NetApp Backup and Recovery向您显示可用于恢复操作的快照。

. 在恢复到最新状态页面中，选择本地、二级存储或对象存储的快照位置。
. 选择“下一步”。
. 在目的地详情页面中，输入以下信息：
+
** *目标设置*：选择是否将数据恢复到原始位置还是其他位置。对于备用位置，请选择主机名和实例，输入数据库名称，然后输入目标路径。
** *预恢复选项*：
+
*** *恢复时覆盖同名数据库*：恢复时，保留原始数据库名称。
*** *保留 SQL 数据库复制设置*：恢复操作后保留 SQL 数据库的复制设置。
*** *恢复前创建事务日志备份*：在恢复操作之前创建事务日志备份。
*** *如果还原前的事务日志备份失败，则退出还原*：如果事务日志备份失败，则停止还原操作。
*** *Prescript*：输入应在恢复操作之前运行的脚本的完整路径、脚本所需的任何参数以及等待脚本完成的时间。


** *恢复后选项*：
+
*** *可操作*，但无法恢复其他事务日志。应用事务日志备份后，数据库将恢复在线状态。
*** *不可操作*，但可用于恢复额外的事务日志。在还原事务日志备份的同时，在还原操作后将数据库维持在非操作状态。此选项对于恢复额外的事务日志很有用。
*** *只读模式*，可用于恢复额外的事务日志。以只读模式恢复数据库并应用事务日志备份。
*** *后记*：输入恢复操作后应运行的脚本的完整路径以及脚本所采用的任何参数。




. 选择*恢复*。




== 从 Inventory 选项恢复工作负载数据

从库存页面恢复数据库工作负载。使用 Inventory 选项，您只能恢复数据库，而不能恢复实例。

.步骤
. 从NetApp Backup and Recovery菜单中，选择 *Inventory*。
. 选择要恢复的资源所在的主机。
. 选择*操作*image:icon-action.png["操作图标"]图标，然后选择*查看详细信息*。
. 在 Microsoft SQL Server 页面上，选择“*数据库*”选项卡。
. 在数据库菜单中，选择具有“受保护”状态的数据库。
. 选择*操作*image:icon-action.png["操作图标"]图标，然后选择*恢复*。
+
与从“恢复”页面恢复时出现的三个选项相同：

+
** 从快照还原
** 恢复到特定时间点
** 恢复到最新备份


. 继续执行与“恢复”页面中的恢复选项相同的步骤


ifdef::aws[]

endif::aws[]

ifdef::azure[]

endif::azure[]

ifdef::gcp[]

endif::gcp[]

ifdef::aws[]

endif::aws[]

ifdef::azure[]

endif::azure[]

ifdef::gcp[]

endif::gcp[]
